var appControllers=angular.module("appControllers",[]);appControllers.controller("mainCtrl",["$scope",function(e){console.log("injected")}]),appControllers.controller("sliderCtrl",["$scope",function(e){e.slides=["http://placehold.it/1920x300/015b8d/ffffff","http://placehold.it/1920x300/e82a30/ffffff","http://placehold.it/1920x300/00a4ce/ffffff","http://placehold.it/1920x300/12a750/ffffff","http://placehold.it/1920x300/94bd00/ffffff","http://placehold.it/1920x300/bfa129/ffffff","http://placehold.it/1920x300/9c29bf/ffffff"]}]),appControllers.controller("navigationCtrl",["$scope",function(e){pages=[{url:"#!/",label:"Strona główna",active:!0},{url:"#!/about-us",label:"O właścicielach"},{url:"#!/menu",label:"Menu"},{url:"#!/reservation",label:"Rezerwacja"},{url:"#!/contact",label:"Kontakt"}],pages.reverse(),pages.every(function(e){return!window.location.href.match(e.url)||(pages[pages.length-1].active=!1,e.active=!0,!1)}),pages.reverse(),e.pages=pages}]),appControllers.controller("indexCtrl",["$scope",function(e){}]),appControllers.controller("aboutUsCtrl",["$scope",function(e){}]),appControllers.controller("menuCtrl",["$scope","dataStorageService","dishService",function(e,t,n){e.dishes={},e.dishCategories={},e.currentPage=0,e.pageSize=10,e.dataStorageService=t,n.getDishes().then(function(t){var n=[];angular.forEach(t.data,function(e,t){e.available&&n.push(e)}),e.dishes=n}),n.getDishCategories().then(function(t){e.dishCategory={_id:0,label:"wybierz kategorię dania"},e.dishCategories=[{_id:0,label:"wybierz kategorię dania"}].concat(t.data)}),e.getDishCountByCategoryId=function(t){var n=0;return t?(angular.forEach(e.dishes,function(e,r){e.dishCategoryId==t&&n++}),n):e.dishes.length},e.numberOfPages=function(){return Math.ceil(e.getDishCountByCategoryId(e.dishCategory._id)/e.pageSize)}}]),appControllers.controller("dishCtrl",["$scope","$location","socket","dataStorageService","dishService",function(e,t,n,r,a){var i=r.getData("detailsDishId");i||t.path("/menu"),a.getDish(i).then(function(t){e.dish=t.data[0]}),a.getDishCategories().then(function(t){angular.forEach(t.data,function(t){e.dish.dishCategoryId==t._id&&(e.dishCategory=t)})}),e.getDishComments=function(){a.getDishComments(i).then(function(t){e.dishComments=t.data})},e.getDishRating=function(){a.getDishRatings(i).then(function(t){var n=0,r=0;angular.forEach(t.data,function(e){n++,r+=e.rating}),n||r?e.rating=(r/n).toFixed(2):e.rating="brak ocen"})},e.rateDish=function(t,n){a.addDishRating({dishId:t,rating:n}),e.rated=!0},e.addDishComment=function(t){a.addDishComment({dishId:t,author:e.dishComment.author,comment:e.dishComment.comment,dateAdded:(new Date).valueOf()})},n.on("message",function(t){switch(t){case"DishCommentAdded":e.getDishComments();break;case"DishRatingAdded":e.getDishRating()}}),e.getDishRating(),e.getDishComments()}]),appControllers.controller("reservationCtrl",["$scope","dataStorageService","dishService","reservationService",function(e,t,n,r){n.getDishes().then(function(t){e.dishes=t.data}),n.getDishCategories().then(function(t){e.dishCategories=t.data}),r.getTables().then(function(t){e.tables=t.data}),r.getReservations().then(function(t){e.reservations=t.data})}]),appControllers.controller("contactCtrl",["$scope",function(e){}]);var appFilters=angular.module("appFilters",[]);appFilters.filter("startFrom",function(){return function(e,t){return e.length?(t=+t,e.slice(t)):e}}),appFilters.filter("dishCategoryFilter",function(){return function(e,t){var n=[];return void 0==t||0==t._id?e:(angular.forEach(e,function(e,r){e.dishCategoryId==t._id&&n.push(e)}),n)}});var appServices=angular.module("appServices",[]);appServices.service("dataStorageService",function(){return{data:[],setData:function(e,t){return this.data.push({key:e,data:t}),this},getData:function(e){var t=null;return angular.forEach(this.data,function(n){n.key==e&&(t=n.data)}),t}}}),appServices.factory("socket",["$rootScope",function(e){var t=io.connect("http://zpw.loc");return{on:function(n,r){function a(){var n=arguments;e.$apply(function(){r.apply(t,n)})}return t.on(n,a),function(){t.removeListener(n,a)}},emit:function(n,r,a){t.emit(n,r,function(){var n=arguments;e.$apply(function(){a&&a.apply(t,n)})})}}}]),appServices.service("dishService",["$http","$q",function(e,t){return{getDishes:function(){var n=t.defer();return e.get("/dishes").then(function(e){n.resolve(e)}),n.promise},getDishCategories:function(){var n=t.defer();return e.get("/dish-categories").then(function(e){n.resolve(e)}),n.promise},getDish:function(n){var r=t.defer();return e.get("/dishes/"+n).then(function(e){r.resolve(e)}),r.promise},addDishRating:function(n){t.defer();return e.post("/dish-ratings/",n)},getDishRatings:function(n){var r=t.defer();return e.get("/dish-ratings/"+n).then(function(e){r.resolve(e)}),r.promise},getDishComments:function(n){var r=t.defer();return e.get("/dish-comments/"+n).then(function(e){r.resolve(e)}),r.promise},addDishComment:function(n){t.defer();return e.post("/dish-comments/",n)}}}]),appServices.service("reservationService",["$http","$q",function(e,t){return{getTables:function(){var n=t.defer();return e.get("/tables").then(function(e){n.resolve(e)}),n.promise},getReservations:function(){var n=t.defer();return e.get("/reservations").then(function(e){n.resolve(e)}),n.promise}}}]);var app=angular.module("frontendApp",["ngRoute","appControllers","appServices","appFilters"]);app.config(["$routeProvider",function(e){e.when("/",{templateUrl:"views/index.html",controller:"indexCtrl"}).when("/about-us",{templateUrl:"views/about-us.html",controller:"aboutUsCtrl"}).when("/menu/",{templateUrl:"views/menu.html",controller:"menuCtrl"}).when("/menu/dish",{templateUrl:"views/dish.html",controller:"dishCtrl"}).when("/reservation",{templateUrl:"views/reservation.html",controller:"reservationCtrl"}).when("/contact",{templateUrl:"views/contact.html",controller:"contactCtrl"}).otherwise({redirectTo:"/"})}]);